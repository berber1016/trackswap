# TrackSwap - Multi-Format Track Processing Library

A powerful multi-format track file processing library that supports parsing, encoding, and format conversion for GPX, FIT, and TCX files.

---

**üåê Language / ËØ≠Ë®Ä**: [English](README_EN.md) | [‰∏≠Êñá](README.md)

---

## üöÄ Features

- üîÑ **Multi-Format Support**: GPX 1.1, FIT, TCX formats
- üéØ **Unified Conversion**: Convert between any formats  
- ü§ñ **Auto-Detection**: Intelligently identify file formats
- üîß **Plugin Architecture**: Extensible plugin-based design
- üõ°Ô∏è **Type Safety**: Complete TypeScript support
- ‚ö° **High Performance**: Optimized parsing and encoding algorithms

## üì¶ Installation

```bash
npm install trackswap
```

## üéØ Quick Start

### Basic Usage

```typescript
import { TrackSwap } from 'trackswap';
import fs from 'fs';

const trackSwap = new TrackSwap();

// Parse GPX file
const gpxBuffer = fs.readFileSync('track.gpx');
const gpxData = await trackSwap.parseGPX(gpxBuffer);

// Parse FIT file
const fitBuffer = fs.readFileSync('activity.fit');
const fitData = await trackSwap.parseFIT(fitBuffer);

// Parse TCX file
const tcxBuffer = fs.readFileSync('workout.tcx');
const tcxData = await trackSwap.parseTCX(tcxBuffer);
```

### Format Conversion

```typescript
// üîÑ Auto-detect format and convert
const gpxBuffer = await trackSwap.convertFile(anyBuffer, 'gpx');
const fitBuffer = await trackSwap.convertFile(anyBuffer, 'fit');
const tcxBuffer = await trackSwap.convertFile(anyBuffer, 'tcx');

// üéØ Specify source format for better performance
const convertedBuffer = await trackSwap.convertFile(
  sourceBuffer, 
  'fit',      // target format
  'gpx'       // source format (optional)
);
```

### Auto Parsing

```typescript
// ü§ñ Auto-detect format and parse
const parsedData = await trackSwap.parseFile(buffer);

// üèÉ‚Äç‚ôÇÔ∏è Parse and convert to unified sport data format
const sportData = await trackSwap.parseToActivity(buffer);
```

## üìñ Detailed Usage Guide

### 1. File Parsing

#### GPX File Processing

```typescript
// Parse from Buffer
const gpxData = await trackSwap.parseGPX(buffer);

// Parse from string
const gpxData = await trackSwap.parseGPXString(xmlString);

// Encode to Buffer
const buffer = await trackSwap.encodeGPX(gpxData);

// Encode to string
const xmlString = trackSwap.encodeGPXString(gpxData);
```

#### FIT File Processing

```typescript
// Parse FIT file
const fitData = await trackSwap.parseFIT(buffer);

// Encode to Activity file
const activityBuffer = await trackSwap.encodeFIT(fitData);

// Encode to Course file
const courseBuffer = await trackSwap.encodeFITCourse(fitData);
```

#### TCX File Processing

```typescript
// Parse from Buffer
const tcxData = await trackSwap.parseTCX(buffer);

// Parse from string
const tcxData = await trackSwap.parseTCXString(xmlString);

// Encode to Buffer
const buffer = await trackSwap.encodeTCX(tcxData);

// Encode to string
const xmlString = await trackSwap.encodeTCXString(tcxData);
```

### 2. Format Conversion

#### Unified Conversion Method

```typescript
// üîÑ Auto-detect and convert
const result = await trackSwap.convertFile(sourceBuffer, 'gpx');

// üéØ Specify format conversion
const result = await trackSwap.convertFile(sourceBuffer, 'fit', 'gpx');

// üìä Supported conversion combinations
// GPX ‚Üî FIT ‚Üî TCX (convert between any formats)
```

#### ActivityType Unified Format

```typescript
// Convert to unified sport data format
const gpxActivity = await trackSwap.convertGPXToActivity(gpxData);
const fitActivity = await trackSwap.convertFITToActivity(fitData);
const tcxActivity = await trackSwap.convertTCXToActivity(tcxData);

// Convert from unified format back to specific formats
const gpxData = await trackSwap.convertActivityToGPX(sportData);
const fitData = await trackSwap.convertActivityToFIT(sportData);
const tcxData = await trackSwap.convertActivityToTCX(sportData);
```

### 3. Smart Parsing

```typescript
// ü§ñ Auto-detect format
const format = trackSwap.detectFormat(buffer);
console.log(`Detected format: ${format}`); // 'gpx' | 'fit' | 'tcx' | 'unknown'

// üìÇ Unified parsing method
const parsedData = await trackSwap.parseFile(buffer);
const parsedData = await trackSwap.parseFile(buffer, 'gpx'); // specify format

// üèÉ‚Äç‚ôÇÔ∏è Parse to unified format
const sportData = await trackSwap.parseToActivity(buffer);
const sportData = await trackSwap.parseToActivity(buffer, 'fit'); // specify format
```

## üîß API Reference

### TrackSwap Class

#### Parsing Methods

| Method | Description | Parameters | Return Value |
|--------|-------------|------------|--------------|
| `parseGPX(buffer)` | Parse GPX Buffer | `Buffer` | `Promise<GPX11Type \| undefined>` |
| `parseGPXString(xml)` | Parse GPX string | `string` | `Promise<GPX11Type \| undefined>` |
| `parseFIT(buffer)` | Parse FIT Buffer | `Buffer` | `Promise<FITFileType>` |
| `parseTCX(buffer)` | Parse TCX Buffer | `Buffer` | `Promise<TCXFileType>` |
| `parseTCXString(xml)` | Parse TCX string | `string` | `Promise<TCXFileType>` |
| `parseFile(buffer, type?)` | Unified parsing method | `Buffer, string?` | `Promise<GPX11Type \| FITFileType \| TCXFileType>` |
| `parseToActivity(buffer, type?)` | Parse to unified format | `Buffer, string?` | `Promise<ActivityType>` |

#### Encoding Methods

| Method | Description | Parameters | Return Value |
|--------|-------------|------------|--------------|
| `encodeGPX(data)` | Encode GPX to Buffer | `GPX11Type` | `Promise<Buffer>` |
| `encodeGPXString(data)` | Encode GPX to string | `GPX11Type` | `string` |
| `encodeFIT(data)` | Encode FIT to Buffer | `FITFileType` | `Promise<Buffer>` |
| `encodeFITCourse(data)` | Encode FIT Course | `FITFileType` | `Promise<Buffer>` |
| `encodeTCX(data)` | Encode TCX to Buffer | `TCXFileType` | `Promise<Buffer>` |
| `encodeTCXString(data)` | Encode TCX to string | `TCXFileType` | `Promise<string>` |

#### Conversion Methods

| Method | Description | Parameters | Return Value |
|--------|-------------|------------|--------------|
| `convertFile(buffer, target, source?)` | Unified conversion method | `Buffer, string, string?` | `Promise<Buffer>` |
| `convertGPXToActivity(data)` | GPX ‚Üí Activity | `GPX11Type` | `Promise<ActivityType>` |
| `convertFITToActivity(data)` | FIT ‚Üí Activity | `FITFileType` | `Promise<ActivityType>` |
| `convertTCXToActivity(data)` | TCX ‚Üí Activity | `TCXFileType` | `Promise<ActivityType>` |
| `convertActivityToGPX(data)` | Activity ‚Üí GPX | `ActivityType` | `Promise<GPX11Type>` |
| `convertActivityToFIT(data)` | Activity ‚Üí FIT | `ActivityType` | `Promise<FITFileType>` |
| `convertActivityToTCX(data)` | Activity ‚Üí TCX | `ActivityType` | `Promise<TCXFileType>` |

#### Utility Methods

| Method | Description | Parameters | Return Value |
|--------|-------------|------------|--------------|
| `detectFormat(buffer)` | Detect file format | `Buffer` | `'gpx' \| 'fit' \| 'tcx' \| 'unknown'` |
| `getActivityProcessor()` | Get sport processor | - | `ActivityProcessor` |
| `destroy()` | Clean up resources | - | `Promise<void>` |

## üåü Real-World Examples

### Batch Format Conversion

```typescript
import { TrackSwap } from 'trackswap';
import fs from 'fs';
import path from 'path';

async function batchConvert(inputDir: string, outputFormat: 'gpx' | 'fit' | 'tcx') {
  const trackSwap = new TrackSwap();
  const files = fs.readdirSync(inputDir);
  
  for (const file of files) {
    try {
      const inputPath = path.join(inputDir, file);
      const buffer = fs.readFileSync(inputPath);
      
      // üîÑ Auto-detect and convert
      const converted = await trackSwap.convertFile(buffer, outputFormat);
      
      const outputPath = path.join(inputDir, 
        `${path.parse(file).name}.${outputFormat}`);
      fs.writeFileSync(outputPath, converted);
      
      console.log(`‚úÖ Conversion complete: ${file} ‚Üí ${outputFormat}`);
    } catch (error) {
      console.error(`‚ùå Conversion failed: ${file}`, error);
    }
  }
  
  await trackSwap.destroy();
}

// Usage example
await batchConvert('./tracks', 'gpx');
```

### Track Data Analysis

```typescript
async function analyzeTrack(buffer: Buffer) {
  const trackSwap = new TrackSwap();
  
  // üîç Detect format
  const format = trackSwap.detectFormat(buffer);
  console.log(`File format: ${format}`);
  
  // üìä Convert to unified format for analysis
  const sportData = await trackSwap.parseToActivity(buffer);
  
  // Analyze data
  const analysis = {
    totalDistance: sportData.summary?.totalDistance || 0,
    totalTime: sportData.summary?.totalTime || 0,
    avgSpeed: sportData.summary?.avgSpeed || 0,
    maxSpeed: sportData.summary?.maxSpeed || 0,
    trackPoints: sportData.tracks?.[0]?.segments?.[0]?.points?.length || 0
  };
  
  console.log('Track analysis results:', analysis);
  
  await trackSwap.destroy();
  return analysis;
}
```

### Multi-Format Data Fusion

```typescript
async function mergeMultiFormatTracks(files: { buffer: Buffer, name: string }[]) {
  const trackSwap = new TrackSwap();
  const allActivityData: ActivityType[] = [];
  
  // üîÑ Convert all formats to unified format
  for (const file of files) {
    try {
      const sportData = await trackSwap.parseToActivity(file.buffer);
      sportData.metadata = { ...sportData.metadata, originalFile: file.name };
      allActivityData.push(sportData);
    } catch (error) {
      console.error(`Parsing failed: ${file.name}`, error);
    }
  }
  
  // Data fusion logic
  const mergedData = mergeActivityData(allActivityData);
  
  // Output to different formats
  const results = {
    gpx: await trackSwap.convertActivityToGPX(mergedData),
    fit: await trackSwap.convertActivityToFIT(mergedData),
    tcx: await trackSwap.convertActivityToTCX(mergedData)
  };
  
  await trackSwap.destroy();
  return results;
}
```

## üèóÔ∏è Architecture Design

TrackSwap adopts a modular architecture with core components including:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    TrackSwap Architecture                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  üîß Core Processing Modules                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ GPXDecoder/Encoder - GPX file processing              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ FITDecoder/Encoder - FIT file processing              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ TCXDecoder/Encoder - TCX file processing              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ActivityProcessor - Unified format conversion            ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  üîÑ Conversion Engine                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ GPXToActivityConverter - GPX ‚Üí ActivityType            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ FITToActivityConverter - FIT ‚Üí ActivityType            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ TCXToActivityConverter - TCX ‚Üí ActivityType            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ActivityToGPXEncoder - ActivityType ‚Üí GPX              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ActivityToFITEncoder - ActivityType ‚Üí FIT              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ActivityToTCXEncoder - ActivityType ‚Üí TCX              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  üéØ Unified Interface                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Auto format detection                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Unified parsing methods                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Unified conversion methods                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Lifecycle management                                  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîç Supported Formats

### GPX (GPS Exchange Format)
- ‚úÖ GPX 1.1 standard
- ‚úÖ Waypoints
- ‚úÖ Routes
- ‚úÖ Tracks
- ‚úÖ Metadata
- ‚úÖ Extensions

### FIT (Flexible and Interoperable Data Transfer)
- ‚úÖ Activity files
- ‚úÖ Course files
- ‚úÖ Track point data
- ‚úÖ Heart rate, speed, altitude and other sensor data
- ‚úÖ Garmin device compatibility

### TCX (Training Center XML)
- ‚úÖ Training data
- ‚úÖ Exercise tracks
- ‚úÖ Heart rate zones
- ‚úÖ Lap data
- ‚úÖ Garmin Connect compatibility

## üõ†Ô∏è Development Guide

### Requirements

- Node.js >= 16
- TypeScript >= 4.5

### Project Structure

```
src/
‚îú‚îÄ‚îÄ TrackSwap.ts          # Main entry class
‚îú‚îÄ‚îÄ GPX/                  # GPX module
‚îÇ   ‚îú‚îÄ‚îÄ decoder.ts
‚îÇ   ‚îú‚îÄ‚îÄ encoder.ts
‚îÇ   ‚îî‚îÄ‚îÄ types.ts
‚îú‚îÄ‚îÄ FIT/                  # FIT module
‚îÇ   ‚îú‚îÄ‚îÄ decoder.ts
‚îÇ   ‚îú‚îÄ‚îÄ encoder.ts
‚îÇ   ‚îî‚îÄ‚îÄ types.ts
‚îú‚îÄ‚îÄ TCX/                  # TCX module
‚îÇ   ‚îú‚îÄ‚îÄ decoder.ts
‚îÇ   ‚îú‚îÄ‚îÄ encoder.ts
‚îÇ   ‚îî‚îÄ‚îÄ types.ts
‚îú‚îÄ‚îÄ sport/                # Unified conversion module
‚îÇ   ‚îú‚îÄ‚îÄ processor.ts
‚îÇ   ‚îú‚îÄ‚îÄ converters.ts
‚îÇ   ‚îú‚îÄ‚îÄ encoders.ts
‚îÇ   ‚îî‚îÄ‚îÄ base.ts
‚îî‚îÄ‚îÄ types.ts              # Common type definitions
```

### Contributing Guidelines

1. Fork the project
2. Create a feature branch
3. Commit your changes
4. Create a Pull Request

## üìÑ License

MIT License

## üôè Acknowledgments

Thanks to all contributors and the open source community for their support!

---

<div align="center">
  <strong>TrackSwap - Making Track Data Processing Simple</strong><br>
  üöÄ Efficient ‚Ä¢ üîÑ Unified ‚Ä¢ üõ°Ô∏è Secure ‚Ä¢ üìà Scalable
</div> 